<style type="text/css">
    #mainBubble {
      background: #fff;
      border: solid 1px #ddd;
      box-shadow: 0 0 4px rgba(0,0,0,0);
      font: 10px sans-serif;
      height: 800px;
      position: relative;
      width: 80%;
    }
             
    #mainBubble svg {
      left: 0;
      position: absolute;
      top: 0;
    }
                         
    #mainBubble circle.topBubble {
      fill: #aaa;
      stroke: #666;
      stroke-width: 1.5px;
     }
    </style>
    
    
    <title>
      Bubble Menu
    </title>
   
  
  
<div class="row">
    <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
        <h1 class="page-title txt-color-blueDark"><i class="fa-fw fa fa-bar-chart-o"></i> Queries <span> > Query 1</span></h1>
    </div>
</div>

<section id="widget-grid" class="">

    <div class="row" ng-controller="Query1Controller">

        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
			<div id="mainBubble" style="height: 559px;"><svg class="mainBubbleSVG" width="797.164" height="559"><text id="bubbleItemNote" x="10" y="383.582" font-size="12" dominant-baseline="middle" alignment-baseline="middle" style="fill: rgb(136, 136, 136);">D3.js bubble menu developed by Shipeng Sun (sunsp.gis@gmail.com), Institute of Environment, University of Minnesota, and University of Springfield, Illinois.</text></svg></div>
            <div class="alert alert-info">
                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                        <h4 class="no-margin">What time-based trends exist in Gun ads ? Can you correlate temporal and
                            spatial properties with buyers ? </h4>
                        <h5> <strong>For Example: </strong> Can you identify based on ad time-window and/or
                            based on geospatial area places where people try and purchase guns on behalf of someone unauthorized
                            to purchase them ?</h5>

                        <h5>Examples:</h5>
                        <ul>
                        <li>Show all <strong>shotguns</strong> sold in <strong>Texas</strong>.
                        <li>Find all <strong>rifles </strong> sold in <strong>Texas</strong> from <strong>January 2014</strong> to <strong>December 2014</strong>.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="jarviswidget" id="wid-id-0">
                <header>
                    <span class="widget-icon"> <i class="fa fa-bar-chart-o"></i> </span>
                    <h2>Query 1 : Search Filter </h2>
                </header>

                <div>
                    <div class="jarviswidget-editbox">
                        <input class="form-control" type="text">
                    </div>
                    <div class="widget-body">
                        <form class="form-horizontal">

                            <fieldset>
                                <legend>Query Search Filter</legend>
                                <div class="form-group">
                                    <label class="col-md-2 control-label">Keywords</label>
                                    <div class="col-md-10">
                                        <input class="form-control" placeholder="Enter Search Keywords" type="text">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-md-2 control-label" for="multiselect1">Weapon Categories</label>
                                    <div class="col-md-10">
                                        <select multiple="multiple" id="multiselect1" class="form-control custom-scroll" title="Click to Select a Weapon Category">
                                            <option>Shotguns</option>
                                            <option>Rifles</option>
                                            <option>Pistol</option>
                                            <option>Handguns</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-md-2 control-label">US State</label>
                                    <div class="col-md-10">
                                        <input class="form-control" placeholder="Enter US State" type="text"  list="list">
                                        <datalist id="list">
                                            <option value="Alabama">Alabama</option>
                                            <option value="Alaska">Alaska</option>
                                            <option value="Arizona">Arizona</option>
                                            <option value="Arkansas">Arkansas</option>
                                            <option value="California">California</option>
                                            <option value="Colorado">Colorado</option>
                                            <option value="Connecticut">Connecticut</option>
                                            <option value="Delaware">Delaware</option>
                                            <option value="Florida">Florida</option>
                                            <option value="Georgia">Georgia</option>
                                            <option value="Hawaii">Hawaii</option>
                                            <option value="Idaho">Idaho</option>
                                            <option value="Illinois">Illinois</option>
                                            <option value="Indiana">Indiana</option>
                                            <option value="Iowa">Iowa</option>
                                            <option value="Kansas">Kansas</option>
                                            <option value="Kentucky">Kentucky</option>
                                            <option value="Louisiana">Louisiana</option>
                                            <option value="Maine">Maine</option>
                                            <option value="Maryland">Maryland</option>
                                            <option value="Massachusetts">Massachusetts</option>
                                            <option value="Michigan">Michigan</option>
                                            <option value="Minnesota">Minnesota</option>
                                            <option value="Mississippi">Mississippi</option>
                                            <option value="Missouri">Missouri</option>
                                            <option value="Montana">Montana</option>
                                            <option value="Nebraska">Nebraska</option>
                                            <option value="Nevada">Nevada</option>
                                            <option value="New Hampshire">New Hampshire</option>
                                            <option value="New Jersey">New Jersey</option>
                                            <option value="New Mexico">New Mexico</option>
                                            <option value="New York">New York</option>
                                            <option value="North Carolina">North Carolina</option>
                                            <option value="North Dakota">North Dakota</option>
                                            <option value="Ohio">Ohio</option>
                                            <option value="Oklahoma">Oklahoma</option>
                                            <option value="Oregon">Oregon</option>
                                            <option value="Pennsylvania">Pennsylvania</option>
                                            <option value="Rhode Island">Rhode Island</option>
                                            <option value="South Carolina">South Carolina</option>
                                            <option value="South Dakota">South Dakota</option>
                                            <option value="Tennessee">Tennessee</option>
                                            <option value="Texas">Texas</option>
                                            <option value="Utah">Utah</option>
                                            <option value="Vermont">Vermont</option>
                                            <option value="Virginia">Virginia</option>
                                            <option value="Washington">Washington</option>
                                            <option value="West Virginia">West Virginia</option>
                                            <option value="Wisconsin">Wisconsin</option>
                                            <option value="Wyoming">Wyoming</option>
                                            <option value="Washington DC">Washington DC</option>
                                        </datalist>
                                        <p class="note"><strong>Note:</strong> You can enter multiple states separated by space or comma.</p>
                                    </div>

                                </div>

                                <div class="form-group">
                                    <label class="col-md-2 control-label">Date</label>
                                    <div class="col-md-4">
                                        <p class="input-group">
                                            <input type="text" class="form-control" datepicker-popup="{{format}}"
                                                   ng-model="dt" is-open="opened" min-date="minDate" max-date="'2020-12-12'"
                                                   datepicker-options="dateOptions"  ng-required="false" close-text="Close" />
                                              <span class="input-group-btn">
                                                <button type="button" class="btn btn-default" ng-click="open($event)"><i class="glyphicon glyphicon-calendar"></i></button>
                                              </span>
                                        </p>
                                    </div>
                                </div>

                                <div class="form-actions">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <button class="btn btn-default" type="reset">
                                                Cancel
                                            </button>
                                            <button class="btn btn-primary" type="submit">
                                                <i class="fa fa-save"></i>
                                                Submit
                                            </button>
                                        </div>
                                    </div>
                                </div>


                            </fieldset>
                        </form>

                    </div>
                </div>
            </div>
			
        </article>

    </div>

</section>



<script type="text/javascript">
var w = window.innerWidth*0.68*0.95;
var h = Math.ceil(w*0.7);
var oR = 0;
var nTop = 0;
 
var svgContainer = d3.select("#mainBubble")
   .style("height", h+"px");
 
var svg = d3.select("#mainBubble").append("svg")
     .attr("class", "mainBubbleSVG")
     .attr("width", w)
     .attr("height",h)
     .on("mouseleave", function() {return resetBubbles();});
      
var mainNote = svg.append("text")
 .attr("id", "bubbleItemNote")
 .attr("x", 10)
 .attr("y", w/2-15)
 .attr("font-size", 12)
 .attr("dominant-baseline", "middle")
 .attr("alignment-baseline", "middle")
 .style("fill", "#888888")
 .text(function(d) {return "D3.js bubble menu developed by Shipeng Sun (sunsp.gis@gmail.com), Institute of Environment, University of Minnesota, and University of Springfield, Illinois.";});   


 d3.json("main_bubble.json", function(error, root) {
     console.log(error);
  
     var bubbleObj = svg.selectAll(".topBubble")
             .data(root.children)
         .enter().append("g")
             .attr("id", function(d,i) {return "topBubbleAndText_" + i});
          
     console.log(root);  
     nTop = root.children.length;
     oR = w/(1+3*nTop);  

 h = Math.ceil(w/nTop*2);
 svgContainer.style("height",h+"px");
      
     var colVals = d3.scale.category10();
      
     bubbleObj.append("circle")
         .attr("class", "topBubble")
         .attr("id", function(d,i) {return "topBubble" + i;})
         .attr("r", function(d) { return oR; })
         .attr("cx", function(d, i) {return oR*(3*(1+i)-1);})
         .attr("cy", (h+oR)/3)
         .style("fill", function(d,i) { return colVals(i); }) // #1f77b4
     .style("opacity",0.3)
         .on("mouseover", function(d,i) {return activateBubble(d,i);});
      
          
     bubbleObj.append("text")
         .attr("class", "topBubbleText")
         .attr("x", function(d, i) {return oR*(3*(1+i)-1);})
         .attr("y", (h+oR)/3)
     .style("fill", function(d,i) { return colVals(i); }) // #1f77b4
         .attr("font-size", 30)
         .attr("text-anchor", "middle")
     .attr("dominant-baseline", "middle")
     .attr("alignment-baseline", "middle")
         .text(function(d) {return d.name})      
         .on("mouseover", function(d,i) {return activateBubble(d,i);});
      
      
     for(var iB = 0; iB < nTop; iB++)
     {
         var childBubbles = svg.selectAll(".childBubble" + iB)
             .data(root.children[iB].children)
             .enter().append("g");
              
     //var nSubBubble = Math.floor(root.children[iB].children.length/2.0);   
          
         childBubbles.append("circle")
             .attr("class", "childBubble" + iB)
             .attr("id", function(d,i) {return "childBubble_" + iB + "sub_" + i;})
             .attr("r",  function(d) {return oR/3.0;})
             .attr("cx", function(d,i) {return (oR*(3*(iB+1)-1) + oR*1.5*Math.cos((i-1)*45/180*3.1415926));})
             .attr("cy", function(d,i) {return ((h+oR)/3 +        oR*1.5*Math.sin((i-1)*45/180*3.1415926));})
             .attr("cursor","pointer")
             .style("opacity",0.5)
             .style("fill", "#eee")
             .on("click", function(d,i) {
             window.open(d.address);                 
           })
         .on("mouseover", function(d,i) {
           //window.alert("say something");
           var noteText = "";
           if (d.note == null || d.note == "") {
             noteText = d.address;
           } else {
             noteText = d.note;
           }
           d3.select("#bubbleItemNote").text(noteText);
           })
         .append("svg:title")
         .text(function(d) { return d.address; });   

         childBubbles.append("text")
             .attr("class", "childBubbleText" + iB)
             .attr("x", function(d,i) {return (oR*(3*(iB+1)-1) + oR*1.5*Math.cos((i-1)*45/180*3.1415926));})
             .attr("y", function(d,i) {return ((h+oR)/3 +        oR*1.5*Math.sin((i-1)*45/180*3.1415926));})
             .style("opacity",0.5)
             .attr("text-anchor", "middle")
         .style("fill", function(d,i) { return colVals(iB); }) // #1f77b4
             .attr("font-size", 6)
             .attr("cursor","pointer")
             .attr("dominant-baseline", "middle")
         .attr("alignment-baseline", "middle")
             .text(function(d) {return d.name})      
             .on("click", function(d,i) {
             window.open(d.address);
             }); 

     }

      
     }); 

 resetBubbles = function () {
   w = window.innerWidth*0.68*0.95;
   oR = w/(1+3*nTop);
    
   h = Math.ceil(w/nTop*2);
   svgContainer.style("height",h+"px");

   mainNote.attr("y",h-15);
        
   svg.attr("width", w);
   svg.attr("height",h);       
    
   d3.select("#bubbleItemNote").text("D3.js bubble menu developed by Shipeng Sun (sunsp.gis@gmail.com), Institute of Environment, University of Minnesota, and University of Springfield, Illinois.");
    
   var t = svg.transition()
       .duration(650);
      
     t.selectAll(".topBubble")
         .attr("r", function(d) { return oR; })
         .attr("cx", function(d, i) {return oR*(3*(1+i)-1);})
         .attr("cy", (h+oR)/3);

     t.selectAll(".topBubbleText")
     .attr("font-size", 30)
         .attr("x", function(d, i) {return oR*(3*(1+i)-1);})
         .attr("y", (h+oR)/3);
  
   for(var k = 0; k < nTop; k++) 
   {
     t.selectAll(".childBubbleText" + k)
             .attr("x", function(d,i) {return (oR*(3*(k+1)-1) + oR*1.5*Math.cos((i-1)*45/180*3.1415926));})
             .attr("y", function(d,i) {return ((h+oR)/3 +        oR*1.5*Math.sin((i-1)*45/180*3.1415926));})
         .attr("font-size", 6)
             .style("opacity",0.5);

     t.selectAll(".childBubble" + k)
             .attr("r",  function(d) {return oR/3.0;})
         .style("opacity",0.5)
             .attr("cx", function(d,i) {return (oR*(3*(k+1)-1) + oR*1.5*Math.cos((i-1)*45/180*3.1415926));})
             .attr("cy", function(d,i) {return ((h+oR)/3 +        oR*1.5*Math.sin((i-1)*45/180*3.1415926));});
                  
   }   
 }
      
      
     function activateBubble(d,i) {
         // increase this bubble and decrease others
         var t = svg.transition()
             .duration(d3.event.altKey ? 7500 : 350);
  
         t.selectAll(".topBubble")
             .attr("cx", function(d,ii){
                 if(i == ii) {
                     // Nothing to change
                     return oR*(3*(1+ii)-1) - 0.6*oR*(ii-1);
                 } else {
                     // Push away a little bit
                     if(ii < i){
                         // left side
                         return oR*0.6*(3*(1+ii)-1);
                     } else {
                         // right side
                         return oR*(nTop*3+1) - oR*0.6*(3*(nTop-ii)-1);
                     }
                 }               
             })
             .attr("r", function(d, ii) { 
                 if(i == ii)
                     return oR*1.8;
                 else
                     return oR*0.8;
                 });
                  
         t.selectAll(".topBubbleText")
             .attr("x", function(d,ii){
                 if(i == ii) {
                     // Nothing to change
                     return oR*(3*(1+ii)-1) - 0.6*oR*(ii-1);
                 } else {
                     // Push away a little bit
                     if(ii < i){
                         // left side
                         return oR*0.6*(3*(1+ii)-1);
                     } else {
                         // right side
                         return oR*(nTop*3+1) - oR*0.6*(3*(nTop-ii)-1);
                     }
                 }               
             })          
             .attr("font-size", function(d,ii){
                 if(i == ii)
                     return 30*1.5;
                 else
                     return 30*0.6;              
             });
  
         var signSide = -1;
         for(var k = 0; k < nTop; k++) 
         {
             signSide = 1;
             if(k < nTop/2) signSide = 1;
             t.selectAll(".childBubbleText" + k)
                 .attr("x", function(d,i) {return (oR*(3*(k+1)-1) - 0.6*oR*(k-1) + signSide*oR*2.5*Math.cos((i-1)*45/180*3.1415926));})
                 .attr("y", function(d,i) {return ((h+oR)/3 + signSide*oR*2.5*Math.sin((i-1)*45/180*3.1415926));})
                 .attr("font-size", function(){
                         return (k==i)?12:6;
                     })
                 .style("opacity",function(){
                         return (k==i)?1:0;
                     });
                  
             t.selectAll(".childBubble" + k)
                 .attr("cx", function(d,i) {return (oR*(3*(k+1)-1) - 0.6*oR*(k-1) + signSide*oR*2.5*Math.cos((i-1)*45/180*3.1415926));})
                 .attr("cy", function(d,i) {return ((h+oR)/3 + signSide*oR*2.5*Math.sin((i-1)*45/180*3.1415926));})
                 .attr("r", function(){
                         return (k==i)?(oR*0.55):(oR/3.0);               
                 })
                 .style("opacity", function(){
                         return (k==i)?1:0;                  
                     }); 
         }                   
     }
  
 window.onresize = resetBubbles;
 
    pageSetUp();

</script>
